<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sepetim - StokTakip</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">StokTakip</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-2"></i> Ana Sayfa</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/products.html"><i class="fas fa-boxes me-2"></i> Ürünler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/about.html"><i class="fas fa-info-circle me-2"></i> Hakkımızda</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/services.html"><i class="fas fa-concierge-bell me-2"></i> Hizmetlerimiz</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/projects.html"><i class="fas fa-project-diagram me-2"></i> Projelerimiz</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/contact.html"><i class="fas fa-envelope me-2"></i> İletişim</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <a href="/frontend/cart.html" class="btn btn-outline-light me-2 position-relative">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            0
                        </span>
                    </a>
                    <div class="dropdown">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" id="userMenu" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" id="userDropdown">
                            <li><a class="dropdown-item" href="/frontend/login.html">Giriş Yap</a></li>
                            <li><a class="dropdown-item" href="/frontend/register.html">Kayıt Ol</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Cart Section -->
    <div class="container my-5">
        <h1 class="mb-4">Sepetim</h1>
        <div id="cartEmpty" class="text-center py-5 d-none">
            <i class="fas fa-shopping-cart fa-4x text-muted mb-3"></i>
            <h3>Sepetiniz Boş</h3>
            <p class="text-muted">Sepetinizde henüz ürün bulunmuyor.</p>
            <a href="/frontend/products.html" class="btn btn-primary">Alışverişe Başla</a>
        </div>
        <div id="cartContent">
            <div class="row">
                <div class="col-md-8">
                    <div id="cartItems" class="card mb-4">
                        <!-- Cart items will be added here dynamically -->
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Sipariş Özeti</h5>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Ara Toplam:</span>
                                <span id="subtotal">0.00 TL</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>KDV (%18):</span>
                                <span id="tax">0.00 TL</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between mb-3">
                                <strong>Toplam:</strong>
                                <strong id="total">0.00 TL</strong>
                            </div>
                            <button id="checkoutBtn" class="btn btn-primary w-100" disabled>
                                Siparişi Tamamla
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4">
        <div class="container">
            <div class="row mb-3">
                 <div class="col-md-4">
                    <h5>Site Bağlantıları</h5>
                    <ul class="list-unstyled">
                        <li><a href="/" class="text-light">Ana Sayfa</a></li>
                        <li><a href="/frontend/products.html" class="text-light">Ürünler</a></li>
                        <li><a href="/frontend/about.html" class="text-light">Hakkımızda</a></li>
                        <li><a href="/frontend/services.html" class="text-light">Hizmetlerimiz</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Kurumsal Bağlantılar</h5>
                    <ul class="list-unstyled">
                         <li><a href="/frontend/projects.html" class="text-light">Projelerimiz</a></li>
                        <li><a href="/frontend/contact.html" class="text-light">İletişim</a></li>
                        <li><a href="/frontend/login.html" class="text-light">Giriş Yap</a></li>
                        <li><a href="/frontend/register.html" class="text-light">Kayıt Ol</a></li>
                    </ul>
                </div>
                 <div class="col-md-4">
                    <h5>İletişim</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope me-2"></i> info@stoktakip.com</li>
                        <li><i class="fas fa-phone me-2"></i> 0 (537) 674 71 69</li>
                        <li><i class="fas fa-map-marker-alt me-2"></i> İstanbul, Türkiye</li>
                    </ul>
                     <p class="mt-3 text-muted">Bizimle iletişime geçmekten çekinmeyin.</p>
                </div>
            </div>
             <div class="row">
                <div class="col-md-12">
                    <h5>StokTakip Hakkında</h5>
                    <p>StokTakip, işletmelerin envanterlerini etkili bir şekilde yönetmelerini sağlayan kapsamlı bir web platformudur. Ürün takibi, stok giriş-çıkışları, satış raporları, tedarikçi yönetimi ve barkod entegrasyonu gibi ileri düzey özelliklerle iş süreçlerinizi baştan sona optimize edin. Küçük işletmelerden büyük depolara kadar her ölçekteki işletmenin ihtiyaçlarına uygun çözümler sunarız. Stoklarınızı anlık olarak takip ederek maliyetleri düşürün, verimliliği artırın ve müşteri memnuniyetini en üst düzeye çıkarın.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/script.js"></script>
    <script>
        // Sayfa yüklendiğinde sepeti güncelle
        document.addEventListener('DOMContentLoaded', () => {
            updateCartCount();
            updateUserMenu();
            updateCartDisplay();
        });

        // Sepeti görüntüleme fonksiyonu
        function updateCartDisplay() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartItems = document.getElementById('cartItems');
            const cartEmpty = document.getElementById('cartEmpty');
            const cartContent = document.getElementById('cartContent');
            const checkoutBtn = document.getElementById('checkoutBtn');

            if (cart.length === 0) {
                cartEmpty.classList.remove('d-none');
                cartContent.classList.add('d-none');
                checkoutBtn.disabled = true;
                return;
            }

            cartEmpty.classList.add('d-none');
            cartContent.classList.remove('d-none');
            checkoutBtn.disabled = false;

            let subtotal = 0;
            cartItems.innerHTML = '';

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;

                const itemElement = document.createElement('div');
                itemElement.className = 'card-body border-bottom';
                itemElement.innerHTML = `
                    <div class="row align-items-center">
                        <div class="col-md-2">
                            <img src="${item.image}" alt="${item.name}" class="img-fluid rounded">
                        </div>
                        <div class="col-md-4">
                            <h5 class="mb-0">${item.name}</h5>
                            <p class="text-muted mb-0">${item.description}</p>
                        </div>
                        <div class="col-md-2">
                            <div class="input-group">
                                <button class="btn btn-outline-secondary" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                <input type="text" class="form-control text-center" value="${item.quantity}" readonly>
                                <button class="btn btn-outline-secondary" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            </div>
                        </div>
                        <div class="col-md-2 text-end">
                            <p class="mb-0">${item.price.toFixed(2)} TL</p>
                        </div>
                        <div class="col-md-2 text-end">
                            <button class="btn btn-danger" onclick="removeFromCart(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                cartItems.appendChild(itemElement);
            });

            const tax = subtotal * 0.18;
            const total = subtotal + tax;

            document.getElementById('subtotal').textContent = `${subtotal.toFixed(2)} TL`;
            document.getElementById('tax').textContent = `${tax.toFixed(2)} TL`;
            document.getElementById('total').textContent = `${total.toFixed(2)} TL`;
        }

        // Ürün miktarını güncelleme
        function updateQuantity(productId, newQuantity) {
            if (newQuantity < 1) return;
            
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const itemIndex = cart.findIndex(item => item.id === productId);
            
            if (itemIndex !== -1) {
                cart[itemIndex].quantity = newQuantity;
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                updateCartDisplay();
            }
        }

        // Sepetten ürün silme
        function removeFromCart(productId) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const updatedCart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(updatedCart));
            updateCartCount();
            updateCartDisplay();
            showToast('Ürün sepetten kaldırıldı', 'success');
        }

        // Siparişi tamamlama
        document.getElementById('checkoutBtn').addEventListener('click', async () => {
            const token = localStorage.getItem('token');
            if (!token) {
                showToast('Lütfen önce giriş yapın', 'error');
                setTimeout(() => {
                    window.location.href = '/frontend/login.html';
                }, 1500);
                return;
            }

            try {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                const response = await fetch('/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ items: cart })
                });

                const data = await response.json();

                if (data.success) {
                    localStorage.removeItem('cart');
                    updateCartCount();
                    showToast('Siparişiniz başarıyla oluşturuldu', 'success');
                    setTimeout(() => {
                        window.location.href = '/frontend/orders.html';
                    }, 1500);
                } else {
                    showToast(data.message || 'Sipariş oluşturulurken bir hata oluştu', 'error');
                }
            } catch (error) {
                console.error('Sipariş hatası:', error);
                showToast('Sipariş oluşturulurken bir hata oluştu', 'error');
            }
        });
    </script>
</body>
</html> 