<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ürün Ekle - StokTakip Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/admin/dashboard.html">StokTakip Admin</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAdmin">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAdmin">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/dashboard.html"><i class="fas fa-cogs me-2"></i> Panel</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/products.html"><i class="fas fa-boxes me-2"></i> Ürünler</a>
                    </li>
                     <li class="nav-item">
                        <a class="nav-link active" href="/frontend/admin/addProduct.html"><i class="fas fa-plus-square me-2"></i> Ürün Ekle</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/categories.html"><i class="fas fa-tags me-2"></i> Kategoriler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/users.html"><i class="fas fa-users-cog me-2"></i> Kullanıcılar</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/sales.html"><i class="fas fa-chart-bar me-2"></i> Satışlar</a>
                    </li>
                </ul>
                <div class="d-flex">
                     <ul class="navbar-nav">
                         <li class="nav-item">
                             <a class="nav-link" href="#" onclick="logout()">Çıkış Yap</a>
                         </li>
                     </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Add Product Section -->
    <div class="container my-5">
        <h1>Yeni Ürün Ekle</h1>

        <div class="card">
            <div class="card-body">
                <form id="addProductForm">
                    <div class="mb-3">
                        <label for="productName" class="form-label">Ürün Adı</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    <div class="mb-3">
                        <label for="productDescription" class="form-label">Açıklama</label>
                        <textarea class="form-control" id="productDescription" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="productPrice" class="form-label">Fiyat (TL)</label>
                            <input type="number" class="form-control" id="productPrice" step="0.01" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="productStock" class="form-label">Stok Miktarı</label>
                            <input type="number" class="form-control" id="productStock" min="0" required>
                        </div>
                    </div>
                    <div class="row">
                         <div class="col-md-6 mb-3">
                            <label for="productMaxStock" class="form-label">Maksimum Stok Miktarı</label>
                            <input type="number" class="form-control" id="productMaxStock" min="1" value="100" required>
                        </div>
                         <div class="col-md-6 mb-3">
                            <label for="productCategory" class="form-label">Kategori</label>
                            <select id="productCategory" class="form-select" required>
                                <option value="">Kategori Seçin</option>
                                <!-- Kategoriler JavaScript ile yüklenecek -->
                            </select>
                        </div>
                    </div>
                     <div class="mb-3">
                        <label for="productBarcode" class="form-label">Barkod</label>
                        <input type="text" class="form-control" id="productBarcode">
                    </div>
                    <div class="mb-3">
                        <label for="productImage" class="form-label">Ürün Görseli URL</label>
                        <input type="url" class="form-control" id="productImage">
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Ürün Ekle</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
             <div class="row mb-3">
                <div class="col-12">
                    <h5>StokTakip Hakkında</h5>
                    <p>StokTakip, işletmelerin envanterlerini etkili bir şekilde yönetmelerini sağlayan kapsamlı bir web platformudur. Ürün takibi, stok giriş-çıkışları, satış raporları, tedarikçi yönetimi ve barkod entegrasyonu gibi ileri düzey özelliklerle iş süreçlerinizi baştan sona optimize edin. Küçük işletmelerden büyük depolara kadar her ölçekteki işletmenin ihtiyaçlarına uygun çözümler sunarız. Stoklarınızı anlık olarak takip ederek maliyetleri düşürün, verimliliği artırın ve müşteri memnuniyetini en üst düzeye çıkarın.</p>
                </div>
            </div>
            <div class="row mb-3">
                 <div class="col-md-4">
                    <h5>Site Bağlantıları</h5>
                    <ul class="list-unstyled">
                        <li><a href="/" class="text-light">Ana Sayfa</a></li>
                        <li><a href="/frontend/products.html" class="text-light">Ürünler</a></li>
                        <li><a href="/frontend/about.html" class="text-light">Hakkımızda</a></li>
                        <li><a href="/frontend/services.html" class="text-light">Hizmetlerimiz</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Kurumsal Bağlantılar</h5>
                    <ul class="list-unstyled">
                         <li><a href="/frontend/projects.html" class="text-light">Projelerimiz</a></li>
                        <li><a href="/frontend/contact.html" class="text-light">İletişim</a></li>
                        <li><a href="/frontend/login.html" class="text-light">Giriş Yap</a></li>
                        <li><a href="/frontend/register.html" class="text-light">Kayıt Ol</a></li>
                    </ul>
                </div>
                 <div class="col-md-4">
                    <h5>İletişim</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope me-2"></i> info@stoktakip.com</li>
                        <li><i class="fas fa-phone me-2"></i> 0 (537) 674 71 69</li>
                        <li><i class="fas fa-map-marker-alt me-2"></i> İstanbul, Türkiye</li>
                    </ul>
                     <p class="mt-3 text-muted">Bizimle iletişime geçmekten çekinmeyin.</p>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <p class="mb-0">&copy; 2025 StokTakip. Tüm hakları saklıdır.</p>
            </div>
        </div>
    </footer>

     <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Admin paneli olduğu için sadece admin kullanıcılar görebilmeli
            // Yetkilendirme kontrolü backend'de yapılacak, frontend'de sadece basit bir kontrol ekleyelim
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user.id || user.role !== 'admin') {
                window.location.href = '/frontend/login.html'; // veya yetkisiz sayfa
                return;
            }
            updateCartCount(); // Admin panelinde sepet olmasa da fonksiyonu çağırıyoruz
            updateUserMenu(); // Admin menüsünü güncelle
            loadCategories();
        });

        async function loadCategories() {
            try {
                const response = await fetch('/api/categories');
                const data = await response.json();

                if (data.success) {
                    const categorySelect = document.getElementById('productCategory');
                    data.data.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        categorySelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Kategori yükleme hatası:', error);
                showToast('Kategoriler yüklenirken bir hata oluştu', 'danger');
            }
        }

        document.getElementById('addProductForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const productName = document.getElementById('productName').value;
            const productDescription = document.getElementById('productDescription').value;
            const productPrice = parseFloat(document.getElementById('productPrice').value);
            const productStock = parseInt(document.getElementById('productStock').value);
            const productMaxStock = parseInt(document.getElementById('productMaxStock').value);
            const productCategory = document.getElementById('productCategory').value;
            const productBarcode = document.getElementById('productBarcode').value;
            const productImage = document.getElementById('productImage').value;

            if (!productName || !productPrice || !productStock || !productMaxStock || !productCategory) {
                showToast('Lütfen gerekli alanları doldurun', 'danger');
                return;
            }

             if (productStock > productMaxStock) {
                 showToast('Stok miktarı maksimum stoktan fazla olamaz.', 'danger');
                 return;
             }

            try {
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                         'Authorization': `Bearer ${localStorage.getItem('token')}` // Yetkilendirme tokenı ekle
                    },
                    body: JSON.stringify({
                        name: productName,
                        description: productDescription,
                        price: productPrice,
                        stock: productStock,
                        max_stock: productMaxStock,
                        category_id: productCategory,
                        barcode: productBarcode,
                        image_url: productImage
                    })
                });
                const data = await response.json();

                if (data.success) {
                    showToast('Ürün başarıyla eklendi', 'success');
                    document.getElementById('addProductForm').reset();
                    // İsteğe bağlı: Ürün listesi sayfasına yönlendirme
                    // window.location.href = '/frontend/admin/products.html';
                } else {
                    showToast(data.message || 'Ürün eklenirken bir hata oluştu', 'danger');
                }
            } catch (error) {
                console.error('Ürün ekleme hatası:', error);
                showToast('Ürün eklenirken bir hata oluştu', 'danger');
            }
        });
    </script>
</body>
</html> 