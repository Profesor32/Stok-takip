<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ürünler Yönetimi - StokTakip Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/admin/dashboard.html">StokTakip Admin</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAdmin">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAdmin">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/dashboard.html"><i class="fas fa-cogs me-2"></i> Panel</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/frontend/admin/products.html"><i class="fas fa-boxes me-2"></i> Ürünler</a>
                    </li>
                     <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/addProduct.html"><i class="fas fa-plus-square me-2"></i> Ürün Ekle</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/categories.html"><i class="fas fa-tags me-2"></i> Kategoriler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/users.html"><i class="fas fa-users-cog me-2"></i> Kullanıcılar</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/frontend/admin/sales.html"><i class="fas fa-chart-bar me-2"></i> Satışlar</a>
                    </li>
                </ul>
                 <div class="d-flex">
                     <ul class="navbar-nav">
                         <li class="nav-item">
                             <a class="nav-link" href="#" onclick="logout()">Çıkış Yap</a>
                         </li>
                     </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Products Management Section -->
    <div class="container my-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Ürünler Yönetimi</h1>
            <a href="/frontend/admin/addProduct.html" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Yeni Ürün Ekle
            </a>
        </div>

         <!-- Ürün Listesi -->
        <div class="card">
            <div class="card-body">
                 <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Görsel</th>
                                <th>Ad</th>
                                <th>Kategori</th>
                                <th>Fiyat</th>
                                <th>Stok</th>
                                <th>Barkod</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody id="adminProductList">
                            <!-- Ürünler JavaScript ile buraya eklenecek -->
                        </tbody>
                    </table>
                 </div>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
             <div class="row mb-3">
                <div class="col-12">
                    <h5>StokTakip Hakkında</h5>
                    <p>StokTakip, işletmelerin envanterlerini etkili bir şekilde yönetmelerini sağlayan kapsamlı bir web platformudur. Ürün takibi, stok giriş-çıkışları, satış raporları, tedarikçi yönetimi ve barkod entegrasyonu gibi ileri düzey özelliklerle iş süreçlerinizi baştan sona optimize edin. Küçük işletmelerden büyük depolara kadar her ölçekteki işletmenin ihtiyaçlarına uygun çözümler sunarız. Stoklarınızı anlık olarak takip ederek maliyetleri düşürün, verimliliği artırın ve müşteri memnuniyetini en üst düzeye çıkarın.</p>
                </div>
            </div>
            <div class="row mb-3">
                 <div class="col-md-4">
                    <h5>Site Bağlantıları</h5>
                    <ul class="list-unstyled">
                        <li><a href="/" class="text-light">Ana Sayfa</a></li>
                        <li><a href="/frontend/products.html" class="text-light">Ürünler</a></li>
                        <li><a href="/frontend/about.html" class="text-light">Hakkımızda</a></li>
                        <li><a href="/frontend/services.html" class="text-light">Hizmetlerimiz</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Kurumsal Bağlantılar</h5>
                    <ul class="list-unstyled">
                         <li><a href="/frontend/projects.html" class="text-light">Projelerimiz</a></li>
                        <li><a href="/frontend/contact.html" class="text-light">İletişim</a></li>
                        <li><a href="/frontend/login.html" class="text-light">Giriş Yap</a></li>
                        <li><a href="/frontend/register.html" class="text-light">Kayıt Ol</a></li>
                    </ul>
                </div>
                 <div class="col-md-4">
                    <h5>İletişim</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope me-2"></i> info@stoktakip.com</li>
                        <li><i class="fas fa-phone me-2"></i> 0 (537) 674 71 69</li>
                        <li><i class="fas fa-map-marker-alt me-2"></i> İstanbul, Türkiye</li>
                    </ul>
                     <p class="mt-3 text-muted">Bizimle iletişime geçmekten çekinmeyin.</p>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <p class="mb-0">&copy; 2025 StokTakip. Tüm hakları saklıdır.</p>
            </div>
        </div>
    </footer>

     <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
             // Admin paneli olduğu için sadece admin kullanıcılar görebilmeli
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user.id || user.role !== 'admin') {
                window.location.href = '/frontend/login.html'; // veya yetkisiz sayfa
                return;
            }
            updateCartCount(); // Admin panelinde sepet olmasa da fonksiyonu çağırıyoruz
            updateUserMenu(); // Admin menüsünü güncelle
            loadAdminProducts();
        });

        async function loadAdminProducts() {
            try {
                const response = await fetch('/api/products', {
                     headers: {
                         'Authorization': `Bearer ${localStorage.getItem('token')}` // Yetkilendirme tokenı ekle
                     }
                });
                const data = await response.json();

                if (data.success) {
                    displayAdminProducts(data.data);
                } else {
                    showToast(data.message || 'Ürünler yüklenemedi', 'danger');
                }
            } catch (error) {
                console.error('Admin ürün yükleme hatası:', error);
                showToast('Ürünler yüklenirken bir hata oluştu', 'danger');
            }
        }

        function displayAdminProducts(products) {
            const productListBody = document.getElementById('adminProductList');
            productListBody.innerHTML = ''; // Listeyi temizle

            if (products.length === 0) {
                productListBody.innerHTML = '<tr><td colspan="8" class="text-center">Ürün bulunamadı.</td></tr>';
                return;
            }

            products.forEach(product => {
                const row = `
                    <tr>
                        <td>${product.id}</td>
                        <td><img src="${product.image_url || '../../images/placeholder.jpg'}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover;"></td>
                        <td>${product.name}</td>
                        <td>${product.category_id || 'Belirtilmemiş'}</td> <!-- Kategori adını gösterecek şekilde güncellenecek -->
                        <td>${parseFloat(product.price).toFixed(2)} TL</td>
                        <td>${product.stock}</td>
                        <td>${product.barcode || '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-warning me-2" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                `;
                productListBody.innerHTML += row;
            });
        }

        // Ürün düzenleme (Placeholder)
        function editProduct(productId) {
            showToast(`Ürün ID: ${productId} düzenleniyor (Bu özellik yakında eklenecek)`, 'info');
            // Düzenleme sayfasına yönlendirme veya modal açma mantığı buraya gelecek
        }

        // Ürün silme (Placeholder)
        async function deleteProduct(productId) {
            if (!confirm('Bu ürünü silmek istediğinizden emin misiniz?')) return;

            try {
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'DELETE',
                     headers: {
                         'Authorization': `Bearer ${localStorage.getItem('token')}` // Yetkilendirme tokenı ekle
                     }
                });
                const data = await response.json();

                if (data.success) {
                    showToast('Ürün başarıyla silindi', 'success');
                    loadAdminProducts(); // Listeyi güncelle
                } else {
                    showToast(data.message || 'Ürün silinirken bir hata oluştu', 'danger');
                }
            } catch (error) {
                console.error('Ürün silme hatası:', error);
                showToast('Ürün silinirken bir hata oluştu', 'danger');
            }
        }
    </script>
</body>
</html> 